{% extends "base.html" %}
{% block title %}Add Prospect - MiKlean{% endblock %}

{% block header %}
<div class="flex items-center">
    <a href="{{ url_for('clients.list_clients') }}" class="mr-4 text-gray-900">‚Üê</a>
    <h1 class="text-2xl font-extrabold text-gray-900">Add Prospect</h1>
</div>
{% endblock %}

{% block bottom_nav %}{% endblock %}

{% block content %}
<form method="POST" class="space-y-4">
    <div>
        <label for="name" class="block text-sm font-semibold text-gray-600 mb-2">Name *</label>
        <input type="text" id="name" name="name" required
            value="{{ name or '' }}"
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-yellow-primary focus:outline-none"
            placeholder="Full name">
    </div>
    
    <div>
        <label for="phone" class="block text-sm font-semibold text-gray-600 mb-2">Phone *</label>
        <input type="tel" id="phone" name="phone" required
            value="{{ phone or '' }}"
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-yellow-primary focus:outline-none"
            placeholder="(555) 123-4567">
    </div>
    
    <!-- Address Section -->
    <div class="border-2 border-gray-200 rounded-xl p-4 space-y-4">
        <p class="text-sm font-semibold text-gray-600">Address *</p>
        
        <!-- Search Box -->
        <div class="relative">
            <input type="text" id="address_search" 
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-yellow-primary focus:outline-none bg-yellow-light"
                placeholder="üîç Start typing to search...">
            <p class="text-xs text-gray-500 mt-1">Or enter manually below</p>
        </div>
        
        <div>
            <label for="street1" class="block text-xs font-semibold text-gray-500 mb-1">Street Address</label>
            <input type="text" id="street1" name="street1" required
                value="{{ street1 or '' }}"
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-yellow-primary focus:outline-none"
                placeholder="123 Main St">
        </div>
        
        <div>
            <label for="street2" class="block text-xs font-semibold text-gray-500 mb-1">Apt, Suite, Unit (optional)</label>
            <input type="text" id="street2" name="street2"
                value="{{ street2 or '' }}"
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-yellow-primary focus:outline-none"
                placeholder="Apt 4B">
        </div>
        
        <div class="grid grid-cols-2 gap-3">
            <div>
                <label for="city" class="block text-xs font-semibold text-gray-500 mb-1">City</label>
                <input type="text" id="city" name="city" required
                    value="{{ city or '' }}"
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-yellow-primary focus:outline-none"
                    placeholder="City">
            </div>
            <div>
                <label for="state" class="block text-xs font-semibold text-gray-500 mb-1">State</label>
                <select id="state" name="state" required
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-yellow-primary focus:outline-none">
                    <option value="">State</option>
                    <option value="AL" {% if state == 'AL' %}selected{% endif %}>AL</option>
                    <option value="AK" {% if state == 'AK' %}selected{% endif %}>AK</option>
                    <option value="AZ" {% if state == 'AZ' %}selected{% endif %}>AZ</option>
                    <option value="AR" {% if state == 'AR' %}selected{% endif %}>AR</option>
                    <option value="CA" {% if state == 'CA' %}selected{% endif %}>CA</option>
                    <option value="CO" {% if state == 'CO' %}selected{% endif %}>CO</option>
                    <option value="CT" {% if state == 'CT' %}selected{% endif %}>CT</option>
                    <option value="DE" {% if state == 'DE' %}selected{% endif %}>DE</option>
                    <option value="FL" {% if state == 'FL' %}selected{% endif %}>FL</option>
                    <option value="GA" {% if state == 'GA' %}selected{% endif %}>GA</option>
                    <option value="HI" {% if state == 'HI' %}selected{% endif %}>HI</option>
                    <option value="ID" {% if state == 'ID' %}selected{% endif %}>ID</option>
                    <option value="IL" {% if state == 'IL' %}selected{% endif %}>IL</option>
                    <option value="IN" {% if state == 'IN' %}selected{% endif %}>IN</option>
                    <option value="IA" {% if state == 'IA' %}selected{% endif %}>IA</option>
                    <option value="KS" {% if state == 'KS' %}selected{% endif %}>KS</option>
                    <option value="KY" {% if state == 'KY' %}selected{% endif %}>KY</option>
                    <option value="LA" {% if state == 'LA' %}selected{% endif %}>LA</option>
                    <option value="ME" {% if state == 'ME' %}selected{% endif %}>ME</option>
                    <option value="MD" {% if state == 'MD' %}selected{% endif %}>MD</option>
                    <option value="MA" {% if state == 'MA' %}selected{% endif %}>MA</option>
                    <option value="MI" {% if state == 'MI' %}selected{% endif %}>MI</option>
                    <option value="MN" {% if state == 'MN' %}selected{% endif %}>MN</option>
                    <option value="MS" {% if state == 'MS' %}selected{% endif %}>MS</option>
                    <option value="MO" {% if state == 'MO' %}selected{% endif %}>MO</option>
                    <option value="MT" {% if state == 'MT' %}selected{% endif %}>MT</option>
                    <option value="NE" {% if state == 'NE' %}selected{% endif %}>NE</option>
                    <option value="NV" {% if state == 'NV' %}selected{% endif %}>NV</option>
                    <option value="NH" {% if state == 'NH' %}selected{% endif %}>NH</option>
                    <option value="NJ" {% if state == 'NJ' %}selected{% endif %}>NJ</option>
                    <option value="NM" {% if state == 'NM' %}selected{% endif %}>NM</option>
                    <option value="NY" {% if state == 'NY' %}selected{% endif %}>NY</option>
                    <option value="NC" {% if state == 'NC' %}selected{% endif %}>NC</option>
                    <option value="ND" {% if state == 'ND' %}selected{% endif %}>ND</option>
                    <option value="OH" {% if state == 'OH' %}selected{% endif %}>OH</option>
                    <option value="OK" {% if state == 'OK' %}selected{% endif %}>OK</option>
                    <option value="OR" {% if state == 'OR' %}selected{% endif %}>OR</option>
                    <option value="PA" {% if state == 'PA' %}selected{% endif %}>PA</option>
                    <option value="RI" {% if state == 'RI' %}selected{% endif %}>RI</option>
                    <option value="SC" {% if state == 'SC' %}selected{% endif %}>SC</option>
                    <option value="SD" {% if state == 'SD' %}selected{% endif %}>SD</option>
                    <option value="TN" {% if state == 'TN' %}selected{% endif %}>TN</option>
                    <option value="TX" {% if state == 'TX' %}selected{% endif %}>TX</option>
                    <option value="UT" {% if state == 'UT' %}selected{% endif %}>UT</option>
                    <option value="VT" {% if state == 'VT' %}selected{% endif %}>VT</option>
                    <option value="VA" {% if state == 'VA' %}selected{% endif %}>VA</option>
                    <option value="WA" {% if state == 'WA' %}selected{% endif %}>WA</option>
                    <option value="WV" {% if state == 'WV' %}selected{% endif %}>WV</option>
                    <option value="WI" {% if state == 'WI' %}selected{% endif %}>WI</option>
                    <option value="WY" {% if state == 'WY' %}selected{% endif %}>WY</option>
                    <option value="DC" {% if state == 'DC' %}selected{% endif %}>DC</option>
                </select>
            </div>
        </div>
        
        <div class="w-1/2">
            <label for="zip_code" class="block text-xs font-semibold text-gray-500 mb-1">ZIP Code</label>
            <input type="text" id="zip_code" name="zip_code" required
                value="{{ zip_code or '' }}"
                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-yellow-primary focus:outline-none"
                placeholder="12345">
        </div>
    </div>
    
    <div>
        <label for="email" class="block text-sm font-semibold text-gray-600 mb-2">Email</label>
        <input type="email" id="email" name="email"
            value="{{ email or '' }}"
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-yellow-primary focus:outline-none"
            placeholder="client@example.com">
    </div>
    
    <div>
        <label for="notes" class="block text-sm font-semibold text-gray-600 mb-2">Notes</label>
        <textarea id="notes" name="notes" rows="3"
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-yellow-primary focus:outline-none"
            placeholder="Gate code, pets, special instructions...">{{ notes or '' }}</textarea>
    </div>
    
    <button type="submit" 
        class="w-full bg-yellow-primary text-gray-900 font-bold py-4 rounded-xl hover:bg-yellow-dark transition">
        Save Prospect
    </button>
</form>
{% endblock %}

{% block scripts %}
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLOXScYN0mjaerNSdgCQOkqY5YFK0BWt0&libraries=places&callback=initAutocomplete" async defer></script>
<script>
function initAutocomplete() {
    const searchInput = document.getElementById('address_search');
    
    const autocomplete = new google.maps.places.Autocomplete(searchInput, {
        types: ['address'],
        componentRestrictions: { country: 'us' },
        fields: ['address_components', 'formatted_address']
    });
    
    autocomplete.addListener('place_changed', function() {
        const place = autocomplete.getPlace();
        
        if (!place.address_components) {
            return;
        }
        
        // Clear existing values
        document.getElementById('street1').value = '';
        document.getElementById('city').value = '';
        document.getElementById('state').value = '';
        document.getElementById('zip_code').value = '';
        
        let streetNumber = '';
        let streetName = '';
        
        // Parse address components
        for (const component of place.address_components) {
            const type = component.types[0];
            
            switch (type) {
                case 'street_number':
                    streetNumber = component.long_name;
                    break;
                case 'route':
                    streetName = component.long_name;
                    break;
                case 'locality':
                    document.getElementById('city').value = component.long_name;
                    break;
                case 'administrative_area_level_1':
                    document.getElementById('state').value = component.short_name;
                    break;
                case 'postal_code':
                    document.getElementById('zip_code').value = component.long_name;
                    break;
            }
        }
        
        // Combine street number and name
        document.getElementById('street1').value = streetNumber + (streetNumber && streetName ? ' ' : '') + streetName;
        
        // Clear search box
        searchInput.value = '';
        
        // Focus on street2 in case they need to add apt number
        document.getElementById('street2').focus();
    });
    
    // Prevent form submit on Enter in search box
    searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
        }
    });
}
</script>
<style>
.pac-container {
    border-radius: 12px;
    border: 2px solid #E5E5E5;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    margin-top: 4px;
    font-family: 'Nunito', sans-serif;
}
.pac-item {
    padding: 12px 16px;
    cursor: pointer;
    border-top: 1px solid #F0F0F0;
}
.pac-item:first-child {
    border-top: none;
}
.pac-item:hover {
    background-color: #FFECB3;
}
.pac-item-query {
    font-size: 14px;
    color: #1A1A1A;
}
.pac-matched {
    font-weight: 700;
}
.pac-icon {
    display: none;
}
</style>
{% endblock %}
