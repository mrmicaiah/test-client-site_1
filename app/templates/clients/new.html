{% extends "base.html" %}
{% block title %}Add Prospect - MiKlean{% endblock %}

{% block header %}
<div class="flex items-center justify-between">
    <div class="flex items-center">
        <a href="{{ url_for('clients.list_clients') }}" class="mr-3 text-ink/60 hover:text-ink">
            <i data-lucide="x" class="w-6 h-6"></i>
        </a>
        <h1 class="text-xl font-bold text-ink">Add Prospect</h1>
    </div>
</div>
{% endblock %}

{% block bottom_nav %}{% endblock %}

{% block content %}
<form method="POST" class="space-y-4">
    <div class="card">
        <div class="space-y-4">
            <div>
                <label for="name" class="block text-sm font-medium text-neutral-600 mb-1.5">Name *</label>
                <input type="text" id="name" name="name" required value="{{ name or '' }}"
                    class="input" placeholder="Full name">
            </div>
            
            <div>
                <label for="phone" class="block text-sm font-medium text-neutral-600 mb-1.5">Phone *</label>
                <input type="tel" id="phone" name="phone" required value="{{ phone or '' }}"
                    class="input" placeholder="(555) 123-4567">
            </div>
            
            <div>
                <label for="email" class="block text-sm font-medium text-neutral-600 mb-1.5">Email</label>
                <input type="email" id="email" name="email" value="{{ email or '' }}"
                    class="input" placeholder="client@example.com">
            </div>
        </div>
    </div>
    
    <!-- Address Section -->
    <div class="card">
        <p class="text-sm font-semibold text-ink mb-3">Address</p>
        
        <div class="mb-4">
            <input type="text" id="address_search" 
                class="input bg-brand/10 border-brand/30 font-medium"
                placeholder="ðŸ” Search address...">
            <p class="text-xs text-neutral-400 mt-1.5">Or enter manually below</p>
        </div>
        
        <div class="space-y-3">
            <div>
                <label for="street1" class="block text-xs font-medium text-neutral-500 mb-1">Street Address *</label>
                <input type="text" id="street1" name="street1" required value="{{ street1 or '' }}"
                    class="input" placeholder="123 Main St">
            </div>
            
            <div>
                <label for="street2" class="block text-xs font-medium text-neutral-500 mb-1">Apt, Suite (optional)</label>
                <input type="text" id="street2" name="street2" value="{{ street2 or '' }}"
                    class="input" placeholder="Apt 4B">
            </div>
            
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label for="city" class="block text-xs font-medium text-neutral-500 mb-1">City *</label>
                    <input type="text" id="city" name="city" required value="{{ city or '' }}"
                        class="input" placeholder="City">
                </div>
                <div>
                    <label for="state" class="block text-xs font-medium text-neutral-500 mb-1">State *</label>
                    <select id="state" name="state" required class="input">
                        <option value="">State</option>
                        {% for st in ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY','DC'] %}
                        <option value="{{ st }}" {% if state == st %}selected{% endif %}>{{ st }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="w-1/2">
                <label for="zip_code" class="block text-xs font-medium text-neutral-500 mb-1">ZIP Code *</label>
                <input type="text" id="zip_code" name="zip_code" required value="{{ zip_code or '' }}"
                    class="input" placeholder="12345">
            </div>
        </div>
    </div>
    
    <div class="card">
        <label for="notes" class="block text-sm font-medium text-neutral-600 mb-1.5">Notes</label>
        <textarea id="notes" name="notes" rows="3" class="input"
            placeholder="Gate code, pets, special instructions...">{{ notes or '' }}</textarea>
    </div>
    
    <div class="space-y-3 pt-2">
        <button type="submit" class="btn-primary w-full">Save Prospect</button>
        <a href="{{ url_for('clients.list_clients') }}" class="btn-secondary w-full">Cancel</a>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLOXScYN0mjaerNSdgCQOkqY5YFK0BWt0&libraries=places&callback=initAutocomplete" async defer></script>
<script>
function initAutocomplete() {
    const searchInput = document.getElementById('address_search');
    const autocomplete = new google.maps.places.Autocomplete(searchInput, {
        types: ['address'],
        componentRestrictions: { country: 'us' },
        fields: ['address_components', 'formatted_address']
    });
    
    autocomplete.addListener('place_changed', function() {
        const place = autocomplete.getPlace();
        if (!place.address_components) return;
        
        document.getElementById('street1').value = '';
        document.getElementById('city').value = '';
        document.getElementById('state').value = '';
        document.getElementById('zip_code').value = '';
        
        let streetNumber = '', streetName = '';
        
        for (const component of place.address_components) {
            const type = component.types[0];
            switch (type) {
                case 'street_number': streetNumber = component.long_name; break;
                case 'route': streetName = component.long_name; break;
                case 'locality': document.getElementById('city').value = component.long_name; break;
                case 'administrative_area_level_1': document.getElementById('state').value = component.short_name; break;
                case 'postal_code': document.getElementById('zip_code').value = component.long_name; break;
            }
        }
        
        document.getElementById('street1').value = streetNumber + (streetNumber && streetName ? ' ' : '') + streetName;
        searchInput.value = '';
        document.getElementById('street2').focus();
    });
    
    searchInput.addEventListener('keydown', function(e) { if (e.key === 'Enter') e.preventDefault(); });
}
</script>
<style>
.pac-container { border-radius: 12px; border: 1px solid #E5E5E5; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-top: 6px; }
.pac-item { padding: 12px 16px; cursor: pointer; border-top: 1px solid #F5F5F5; }
.pac-item:first-child { border-top: none; }
.pac-item:hover { background-color: #FFC107; }
.pac-item-query { font-size: 14px; }
.pac-matched { font-weight: 600; }
.pac-icon { display: none; }
</style>
{% endblock %}
