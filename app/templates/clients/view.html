{% extends "base.html" %}
{% block title %}{{ client.name }} - MiKlean{% endblock %}

{% block header %}
<div class="flex items-center justify-between">
    <div class="flex items-center">
        <a href="{{ url_for('clients.list_clients') }}" class="mr-4 text-gray-900">‚Üê</a>
        <div>
            <h1 class="text-2xl font-extrabold text-gray-900">{{ client.name }}</h1>
            <span class="badge badge-{{ client.type }}">{{ client.type|capitalize }}</span>
        </div>
    </div>
    <a href="{{ url_for('clients.edit_client', client_id=client.id) }}" class="text-gray-700">‚úèÔ∏è</a>
</div>
{% endblock %}

{% block content %}
<!-- Contact Info -->
<p class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">CONTACT</p>
<div class="card mb-4">
    <a href="tel:{{ client.phone }}" class="flex items-center py-3 border-b border-gray-100">
        <span class="mr-3">üìû</span>
        <span class="flex-1 text-gray-900">{{ client.phone }}</span>
        <span class="text-gray-400">‚Üí</span>
    </a>
    {% if client.email %}
    <a href="mailto:{{ client.email }}" class="flex items-center py-3 border-b border-gray-100">
        <span class="mr-3">‚úâÔ∏è</span>
        <span class="flex-1 text-gray-900">{{ client.email }}</span>
        <span class="text-gray-400">‚Üí</span>
    </a>
    {% endif %}
    <a href="https://maps.google.com/?q={{ client.address|urlencode }}" target="_blank" class="flex items-center py-3">
        <span class="mr-3">üìç</span>
        <span class="flex-1 text-gray-900">{{ client.address }}</span>
        <span class="text-gray-400">‚Üí</span>
    </a>
</div>

<!-- Notes -->
{% if client.notes %}
<p class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">NOTES</p>
<div class="card mb-4">
    <p class="text-gray-700 whitespace-pre-wrap">{{ client.notes }}</p>
</div>
{% endif %}

<!-- Actions -->
<p class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">ACTIONS</p>
<div class="space-y-2 mb-4">
    {% if client.type == 'prospect' %}
    <a href="{{ url_for('estimates.new_estimate', client_id=client.id) }}" 
       class="block w-full text-center bg-yellow-primary text-gray-900 font-bold py-4 rounded-xl">
        Create Estimate
    </a>
    {% else %}
    <a href="{{ url_for('visits.schedule_visits', client_id=client.id) }}" 
       class="block w-full text-center bg-yellow-primary text-gray-900 font-bold py-4 rounded-xl">
        Schedule Visit
    </a>
    <a href="{{ url_for('invoices.create_invoice', client_id=client.id) }}" 
       class="block w-full text-center bg-gray-900 text-white font-bold py-4 rounded-xl">
        Invoice for Month
    </a>
    {% endif %}
</div>

<!-- Estimates -->
{% if estimates %}
<p class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">ESTIMATES</p>
<div class="space-y-2 mb-4">
    {% for estimate in estimates %}
    <div class="card">
        <a href="{{ url_for('estimates.view_estimate', estimate_id=estimate.id) }}" class="block">
            <div class="flex justify-between items-center">
                <div>
                    <p class="font-semibold text-gray-900">${{ "%.2f"|format(estimate.price_per_visit) }}/visit</p>
                    <p class="text-sm text-gray-600">{{ estimate.frequency|capitalize }}</p>
                </div>
                <span class="badge badge-{{ estimate.status }}">{{ estimate.status|capitalize }}</span>
            </div>
        </a>
        {% if estimate.status in ['draft', 'sent'] %}
        <div class="mt-3 pt-3 border-t border-gray-100 flex space-x-2">
            <form method="POST" action="{{ url_for('estimates.accept_estimate', estimate_id=estimate.id) }}" class="flex-1">
                <button type="submit" class="w-full bg-green-500 text-white font-bold py-2 rounded-lg text-sm">
                    ‚úì Accept
                </button>
            </form>
            <a href="{{ url_for('estimates.view_estimate', estimate_id=estimate.id) }}" 
               class="flex-1 text-center border border-gray-300 text-gray-700 font-bold py-2 rounded-lg text-sm">
                View
            </a>
        </div>
        {% elif estimate.status == 'accepted' %}
        <div class="mt-3 pt-3 border-t border-gray-100">
            <a href="{{ url_for('visits.schedule_visits', client_id=client.id) }}" 
               class="block w-full text-center bg-yellow-primary text-gray-900 font-bold py-2 rounded-lg text-sm">
                Add to Schedule
            </a>
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Upcoming Visits -->
{% if upcoming_visits %}
<p class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">UPCOMING VISITS</p>
<div class="card mb-4">
    {% for visit in upcoming_visits[:5] %}
    <a href="{{ url_for('visits.view_visit', visit_id=visit.id) }}" 
       class="flex items-center justify-between py-3 {% if not loop.last %}border-b border-gray-100{% endif %}">
        <span class="text-gray-900">{{ visit.scheduled_date }}</span>
        {% if visit.scheduled_time %}
        <span class="text-gray-600 text-sm">{{ visit.scheduled_time[:5] }}</span>
        {% endif %}
        <span class="badge badge-scheduled">Scheduled</span>
    </a>
    {% endfor %}
</div>
{% endif %}

<!-- Past Visits -->
{% if past_visits %}
<p class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">PAST VISITS</p>
<div class="card mb-4">
    {% for visit in past_visits[:5] %}
    <div class="flex items-center justify-between py-3 {% if not loop.last %}border-b border-gray-100{% endif %}">
        <span class="text-gray-700">{{ visit.scheduled_date }}</span>
        <span class="badge badge-{{ visit.status }}">{{ visit.status|capitalize }}</span>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Invoices -->
{% if invoices %}
<p class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">INVOICES</p>
<div class="space-y-2 mb-4">
    {% for invoice in invoices[:5] %}
    <a href="{{ url_for('invoices.view_invoice', invoice_id=invoice.id) }}" class="card block">
        <div class="flex justify-between items-center">
            <div>
                <p class="font-semibold text-gray-900">{{ invoice.invoice_number }}</p>
                <p class="text-sm text-gray-600">${{ "%.2f"|format(invoice.total) }}</p>
            </div>
            <span class="badge badge-{{ invoice.status }}">{{ invoice.status|capitalize }}</span>
        </div>
    </a>
    {% endfor %}
</div>
{% endif %}
{% endblock %}
