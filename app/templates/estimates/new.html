{% extends "base.html" %}
{% block title %}Create Estimate - MiKlean{% endblock %}

{% block header %}
<div class="flex items-center">
    <a href="{{ url_for('clients.view_client', client_id=client.id) }}" class="mr-3 text-ink/60 hover:text-ink">
        <i data-lucide="x" class="w-6 h-6"></i>
    </a>
    <div>
        <h1 class="text-xl font-bold text-ink">Create Estimate</h1>
        <p class="text-sm text-ink/60">for {{ client.name }}</p>
    </div>
</div>
{% endblock %}

{% block bottom_nav %}{% endblock %}

{% block content %}
<form method="POST" class="space-y-4">
    <div class="card">
        <label for="description" class="block text-sm font-medium text-neutral-600 mb-1.5">Service Description *</label>
        <textarea id="description" name="description" rows="4" required class="input"
            placeholder="Describe what you'll do...">{{ description or '' }}</textarea>
    </div>
    
    <div class="card card-brand">
        <label for="price_per_visit" class="block text-sm font-medium text-neutral-600 mb-1.5">Price Per Visit *</label>
        <input type="text" id="price_per_visit" name="price_per_visit" required value="{{ price_per_visit or '' }}"
            class="input text-2xl font-bold" placeholder="$150.00">
    </div>
    
    <div class="card">
        <label class="block text-sm font-medium text-neutral-600 mb-3">Frequency *</label>
        <div class="grid grid-cols-4 gap-2">
            <label class="relative">
                <input type="radio" name="frequency" value="weekly" class="peer sr-only" {% if frequency == 'weekly' %}checked{% endif %}>
                <div class="px-2 py-3 text-center rounded-lg cursor-pointer border-b-3 border-neutral-200 bg-neutral-50 text-neutral-600 peer-checked:border-brand peer-checked:bg-brand/10 peer-checked:text-ink font-semibold text-sm transition-all">
                    Weekly
                </div>
            </label>
            <label class="relative">
                <input type="radio" name="frequency" value="biweekly" class="peer sr-only" {% if frequency == 'biweekly' %}checked{% endif %}>
                <div class="px-2 py-3 text-center rounded-lg cursor-pointer border-b-3 border-neutral-200 bg-neutral-50 text-neutral-600 peer-checked:border-brand peer-checked:bg-brand/10 peer-checked:text-ink font-semibold text-sm transition-all">
                    Bi-Wk
                </div>
            </label>
            <label class="relative">
                <input type="radio" name="frequency" value="monthly" class="peer sr-only" {% if frequency == 'monthly' %}checked{% endif %}>
                <div class="px-2 py-3 text-center rounded-lg cursor-pointer border-b-3 border-neutral-200 bg-neutral-50 text-neutral-600 peer-checked:border-brand peer-checked:bg-brand/10 peer-checked:text-ink font-semibold text-sm transition-all">
                    Monthly
                </div>
            </label>
            <label class="relative">
                <input type="radio" name="frequency" value="one_time" class="peer sr-only" {% if frequency == 'one_time' %}checked{% endif %}>
                <div class="px-2 py-3 text-center rounded-lg cursor-pointer border-b-3 border-neutral-200 bg-neutral-50 text-neutral-600 peer-checked:border-brand peer-checked:bg-brand/10 peer-checked:text-ink font-semibold text-sm transition-all">
                    Once
                </div>
            </label>
        </div>
    </div>
    
    <div class="card">
        <p class="text-sm font-medium text-neutral-600 mb-3">Schedule Preference</p>
        <div class="grid grid-cols-2 gap-3">
            <div>
                <label for="preferred_day" class="block text-xs text-neutral-400 mb-1">Day</label>
                <select id="preferred_day" name="preferred_day" class="input">
                    <option value="">No preference</option>
                    <option value="monday" {% if preferred_day == 'monday' %}selected{% endif %}>Monday</option>
                    <option value="tuesday" {% if preferred_day == 'tuesday' %}selected{% endif %}>Tuesday</option>
                    <option value="wednesday" {% if preferred_day == 'wednesday' %}selected{% endif %}>Wednesday</option>
                    <option value="thursday" {% if preferred_day == 'thursday' %}selected{% endif %}>Thursday</option>
                    <option value="friday" {% if preferred_day == 'friday' %}selected{% endif %}>Friday</option>
                    <option value="saturday" {% if preferred_day == 'saturday' %}selected{% endif %}>Saturday</option>
                    <option value="sunday" {% if preferred_day == 'sunday' %}selected{% endif %}>Sunday</option>
                </select>
            </div>
            <div>
                <label for="preferred_time" class="block text-xs text-neutral-400 mb-1">Time</label>
                <select id="preferred_time" name="preferred_time" class="input">
                    <option value="">No preference</option>
                    <option value="Morning" {% if preferred_time == 'Morning' %}selected{% endif %}>Morning</option>
                    <option value="Afternoon" {% if preferred_time == 'Afternoon' %}selected{% endif %}>Afternoon</option>
                    <option value="Evening" {% if preferred_time == 'Evening' %}selected{% endif %}>Evening</option>
                </select>
            </div>
        </div>
        
        <div id="monthly-rate-option" class="flex items-center mt-4 pt-4 border-t border-neutral-100">
            <input type="checkbox" id="show_monthly_rate" name="show_monthly_rate" 
                {% if show_monthly_rate is not defined or show_monthly_rate %}checked{% endif %}
                class="w-5 h-5 rounded border-neutral-300 text-brand focus:ring-brand">
            <label for="show_monthly_rate" class="ml-3 text-neutral-600 text-sm">Show monthly rate on estimate</label>
        </div>
    </div>
    
    <div class="space-y-3 pt-2">
        <button type="submit" class="btn-primary w-full">Save Estimate</button>
        <a href="{{ url_for('clients.view_client', client_id=client.id) }}" class="btn-secondary w-full">Cancel</a>
    </div>
</form>

<script>
    document.querySelectorAll('input[name="frequency"]').forEach(radio => {
        radio.addEventListener('change', () => {
            const monthlyOption = document.getElementById('monthly-rate-option');
            monthlyOption.style.display = (radio.value === 'one_time' && radio.checked) ? 'none' : 'flex';
        });
    });
</script>
{% endblock %}
