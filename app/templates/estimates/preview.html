{% extends "base.html" %}
{% block title %}Preview Estimate - MiKlean{% endblock %}

{% block header %}
<div class="flex items-center">
    <a href="{{ url_for('estimates.view_estimate', estimate_id=estimate.id) }}" class="mr-4 text-gray-900">←</a>
    <h1 class="text-2xl font-extrabold text-gray-900">Preview</h1>
</div>
{% endblock %}

{% block bottom_nav %}{% endblock %}

{% block content %}
<!-- Professional Estimate Preview -->
<div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-4">
    <!-- Header -->
    <div class="bg-gray-900 text-white p-6">
        <div class="flex justify-between items-start">
            <div>
                {% if profile and profile.business_logo_url %}
                <img src="{{ profile.business_logo_url }}" alt="Logo" class="h-12 mb-2">
                {% endif %}
                <h2 class="text-xl font-bold">{{ profile.business_name if profile and profile.business_name else 'Your Business' }}</h2>
                {% if profile and profile.business_phone %}
                <p class="text-gray-300 text-sm">{{ profile.business_phone }}</p>
                {% endif %}
            </div>
            <div class="text-right">
                <p class="text-2xl font-bold">ESTIMATE</p>
                <p class="text-gray-300 text-sm">Valid for 30 days</p>
            </div>
        </div>
    </div>
    
    <!-- Client Info -->
    <div class="p-6 border-b border-gray-100">
        <p class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-1">PREPARED FOR</p>
        <p class="text-lg font-bold text-gray-900">{{ estimate.clients.name }}</p>
        <p class="text-gray-600">{{ estimate.clients.address }}</p>
    </div>
    
    <!-- Service Description -->
    <div class="p-6 border-b border-gray-100">
        <p class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">SERVICE DESCRIPTION</p>
        <p class="text-gray-800 whitespace-pre-wrap">{{ estimate.description }}</p>
    </div>
    
    <!-- Pricing -->
    <div class="p-6 bg-yellow-light">
        <div class="flex justify-between items-center mb-2">
            <span class="text-gray-700">{{ estimate.frequency|capitalize }} Service</span>
            <span class="text-2xl font-bold text-gray-900">${{ "%.2f"|format(estimate.price_per_visit) }}</span>
        </div>
        <p class="text-gray-600 text-sm">per visit</p>
        
        {% if monthly_rate and estimate.show_monthly_rate %}
        <div class="mt-4 pt-4 border-t border-yellow-dark border-opacity-30">
            <div class="flex justify-between items-center">
                <span class="text-gray-700">Estimated Monthly</span>
                <span class="text-xl font-bold text-gray-900">${{ "%.2f"|format(monthly_rate) }}</span>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Schedule Preference -->
    {% if estimate.preferred_day or estimate.preferred_time %}
    <div class="p-6 border-b border-gray-100">
        <p class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">PREFERRED SCHEDULE</p>
        <p class="text-gray-800">
            {% if estimate.preferred_day %}{{ estimate.preferred_day|capitalize }}s{% endif %}
            {% if estimate.preferred_day and estimate.preferred_time %} • {% endif %}
            {% if estimate.preferred_time %}{{ estimate.preferred_time }}{% endif %}
        </p>
    </div>
    {% endif %}
    
    <!-- Footer -->
    <div class="p-6 text-center bg-gray-50">
        <p class="text-gray-500 text-sm">Questions? Contact us at {{ profile.business_phone if profile and profile.business_phone else 'your phone' }}</p>
    </div>
</div>

<!-- Actions -->
<div class="space-y-2">
    <a href="{{ url_for('estimates.send_estimate', estimate_id=estimate.id) }}" 
       class="block w-full text-center bg-yellow-primary text-gray-900 font-bold py-4 rounded-xl">
        Send Estimate
    </a>
    <a href="{{ url_for('estimates.download_estimate_pdf', estimate_id=estimate.id) }}" 
       class="block w-full text-center border-2 border-gray-900 text-gray-900 font-bold py-4 rounded-xl">
        Download PDF
    </a>
    <a href="{{ url_for('estimates.edit_estimate', estimate_id=estimate.id) }}" 
       class="block w-full text-center text-gray-600 font-semibold py-3">
        Edit
    </a>
</div>
{% endblock %}
